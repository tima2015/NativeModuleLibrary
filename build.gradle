plugins {
    id 'java'
    id "io.github.tomtzook.gradle-cmake" version "1.0.0"
    id 'org.springframework.boot' version '2.7.3'
    id 'io.spring.dependency-management' version '1.0.13.RELEASE'
}

group 'ru.funnydwarf.iot.nml'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    //implementation "com.fasterxml.jackson.core:jackson-databind:2.13.3"
}

jar {
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

machines.customMachines.register("linux-aarch64") {
    it.toolchainFile.set(project.file('JNI-Library/aarch64-linux-gnu-gcc.cmake'))
}

def compileMachineTargets = []
compileMachineTargets.addAll(machines.customMachines)

cmake {
    targets {
        jni_library {
            cmakeLists.set(file('JNI-Library/CMakeLists.txt'))
            targetMachines.set(compileMachineTargets)
        }
    }
}

tasks.clean.dependsOn tasks.cmakeClean
tasks.build.dependsOn tasks.cmakeBuild